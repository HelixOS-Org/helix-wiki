# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                                                                            â•‘
# â•‘   â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—         â•‘
# â•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘         â•‘
# â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ•”â•     â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘         â•‘
# â•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘         â•‘
# â•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—    â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘         â•‘
# â•‘   â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•šâ•â•  â•šâ•â•     â•šâ•â•â•â•šâ•â•â• â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•     â•‘
# â•‘                                                                            â•‘
# â•‘   ğŸ”’ ULTRA-SECURE PRODUCTION PIPELINE v4.0                                â•‘
# â•‘   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                  â•‘
# â•‘                                                                            â•‘
# â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â•‘
# â•‘   â”‚ ğŸ›¡ï¸ SECURE â”‚  â”‚ âœ¨ QUALITYâ”‚  â† Parallel Gate (non-blocking)            â•‘
# â•‘   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                            â•‘
# â•‘         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â•‘
# â•‘         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                                                  â•‘
# â•‘         â”‚ ğŸ”¨ BUILD +   â”‚  â† Build, Harden .htaccess, Deploy FTPS          â•‘
# â•‘         â”‚ ğŸ›¡ï¸ HARDEN +  â”‚                                                  â•‘
# â•‘         â”‚ ğŸš€ DEPLOY    â”‚                                                  â•‘
# â•‘         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â•‘
# â•‘         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                                                  â•‘
# â•‘         â”‚ âœ… VERIFY +   â”‚  â† Health, Security Headers, SEO, Performance   â•‘
# â•‘         â”‚ ğŸ“Š REPORT    â”‚                                                  â•‘
# â•‘         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â•‘
# â•‘                                                                            â•‘
# â•‘   Target:    Hostinger (FTPS)                                              â•‘
# â•‘   Domain:    helix-wiki.com                                                â•‘
# â•‘   Framework: Next.js 16 Static Export                                      â•‘
# â•‘                                                                            â•‘
# â•‘   Secrets:   FTP_SERVER Â· FTP_USERNAME Â· FTP_PASSWORD Â· FTP_REMOTE_PATH    â•‘
# â•‘                                                                            â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: ğŸš€ Deploy to Production

on:
  push:
    branches: [main]
  workflow_dispatch:
    inputs:
      skip_checks:
        description: "âš¡ Skip security & quality gates (emergency)"
        type: boolean
        default: false

concurrency:
  group: production-${{ github.ref }}
  cancel-in-progress: true

env:
  NODE_VERSION: "20"
  SITE_URL: "https://helix-wiki.com"

permissions:
  contents: read
  actions: read

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  J O B S
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
jobs:

  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  #  ğŸ›¡ï¸ SECURITY GATE  (parallel, non-blocking)
  #  Secret scanning â€¢ Dependency audit â€¢ License compliance
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  security:
    name: "ğŸ›¡ï¸ Security Gate"
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.skip_checks != 'true' }}
    timeout-minutes: 8
    continue-on-error: true

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ” Secret leak scanner (15 patterns)
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  ğŸ” SECRET LEAK SCANNER              â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

          PATTERNS=(
            'AKIA[0-9A-Z]{16}'
            '(?i)(aws)?_?secret_?access_?key.*[:=]\s*[A-Za-z0-9/+=]{40}'
            'AIza[0-9A-Za-z\-_]{35}'
            'sk-[0-9a-zA-Z]{20,}'
            'ghp_[0-9a-zA-Z]{36}'
            'github_pat_[0-9a-zA-Z_]{82}'
            'glpat-[0-9a-zA-Z\-_]{20}'
            'xox[baprs]-[0-9a-zA-Z\-]{10,}'
            'sk_live_[0-9a-zA-Z]{24,}'
            'pk_live_[0-9a-zA-Z]{24,}'
            'SG\.[0-9A-Za-z\-_]{22}\.[0-9A-Za-z\-_]{43}'
            '-----BEGIN (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----'
            'mongodb(\+srv)?://[^\s"]+@[^\s"]+'
            'postgres(ql)?://[^\s"]+@[^\s"]+'
            'eyJ[A-Za-z0-9_-]{10,}\.[A-Za-z0-9_-]{10,}\.'
          )

          FOUND=0
          for p in "${PATTERNS[@]}"; do
            if grep -rPn "$p" --include="*.{ts,tsx,js,jsx,json,env,md}" . 2>/dev/null \
               | grep -v node_modules | grep -v '.git/' | grep -v deploy.yml | grep -v package-lock; then
              FOUND=$((FOUND + 1))
            fi
          done

          if [ $FOUND -gt 0 ]; then
            echo "  ğŸš¨ $FOUND secret pattern(s) detected!"
            exit 1
          fi
          echo "  âœ… Clean â€” no secrets found (15 patterns scanned)"

      - uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: npm

      - run: npm ci --ignore-scripts

      - name: ğŸ” Dependency audit
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  ğŸ” DEPENDENCY AUDIT                 â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

          AUDIT=$(npm audit --json 2>/dev/null || true)
          CRIT=$(echo "$AUDIT" | jq '.metadata.vulnerabilities.critical // 0' 2>/dev/null || echo 0)
          HIGH=$(echo "$AUDIT" | jq '.metadata.vulnerabilities.high // 0' 2>/dev/null || echo 0)
          MOD=$(echo "$AUDIT"  | jq '.metadata.vulnerabilities.moderate // 0' 2>/dev/null || echo 0)
          LOW=$(echo "$AUDIT"  | jq '.metadata.vulnerabilities.low // 0' 2>/dev/null || echo 0)

          echo "  ğŸ”´ Critical: $CRIT"
          echo "  ğŸŸ  High:     $HIGH"
          echo "  ğŸŸ¡ Moderate: $MOD"
          echo "  ğŸŸ¢ Low:      $LOW"

          [ "$CRIT" -gt 0 ] 2>/dev/null && { echo "  ğŸš¨ Critical vulns â€” review required"; exit 1; }
          echo "  âœ… Audit passed"

      - name: ğŸ“œ License compliance
        continue-on-error: true
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  ğŸ“œ LICENSE COMPLIANCE               â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

          BANNED="GPL-3.0-only|AGPL|SSPL|EUPL"
          V=0
          for pkg in node_modules/*/package.json; do
            LIC=$(jq -r '.license // "MIT"' "$pkg" 2>/dev/null)
            echo "$LIC" | grep -qEi "$BANNED" && { echo "  âš ï¸ $(basename $(dirname $pkg)) â†’ $LIC"; V=$((V+1)); }
          done
          [ $V -eq 0 ] && echo "  âœ… All licenses compliant" || echo "  âš ï¸ $V restricted license(s)"

  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  #  âœ¨ QUALITY GATE  (parallel, non-blocking)
  #  ESLint â€¢ TypeScript strict â€¢ Codebase metrics
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  quality:
    name: "âœ¨ Quality Gate"
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.skip_checks != 'true' }}
    timeout-minutes: 8
    continue-on-error: true

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: npm

      - run: npm ci

      - name: ğŸ” ESLint analysis
        continue-on-error: true
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  ğŸ” ESLINT ANALYSIS                  â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

          npx eslint . --format stylish 2>&1 || true
          ERRS=$(npx eslint . --format json 2>/dev/null | jq '[.[].errorCount] | add // 0' 2>/dev/null || echo 0)
          WARNS=$(npx eslint . --format json 2>/dev/null | jq '[.[].warningCount] | add // 0' 2>/dev/null || echo 0)
          echo "  ğŸ“Š $ERRS error(s), $WARNS warning(s)"
          [ "$ERRS" = "0" ] && echo "  âœ… Lint passed" || echo "  âš ï¸ Lint issues (non-blocking)"

      - name: ğŸ” TypeScript strict
        continue-on-error: true
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  ğŸ” TYPESCRIPT STRICT                â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

          npx tsc --noEmit 2>&1 && echo "  âœ… Zero type errors" || echo "  âš ï¸ Type issues (non-blocking)"

      - name: ğŸ“ Codebase metrics
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  ğŸ“ CODEBASE METRICS                 â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

          TS=$(find . -name '*.ts' -o -name '*.tsx' | grep -v node_modules | grep -v .next | wc -l)
          COMP=$(find ./components -name '*.tsx' 2>/dev/null | wc -l)
          PAGES=$(find ./app -name 'page.tsx' 2>/dev/null | wc -l)
          LINES=$(find . \( -name '*.ts' -o -name '*.tsx' \) ! -path '*/node_modules/*' ! -path '*/.next/*' -exec cat {} + 2>/dev/null | wc -l)
          echo "  ğŸ“„ Files: $TS  ğŸ§© Components: $COMP  ğŸ“‘ Pages: $PAGES  ğŸ“ Lines: $LINES"

  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  #  ğŸ”¨ BUILD + ğŸ›¡ï¸ HARDEN + ğŸš€ DEPLOY
  #  Next.js build â€¢ .htaccess â€¢ SBOM â€¢ Checksums â€¢ FTPS deploy
  #
  #  âš ï¸ Single job to guarantee .htaccess is in the output when deploying.
  #     No artifact handoff = no missing file issues.
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  build-and-deploy:
    name: "ğŸ”¨ Build â†’ ğŸ›¡ï¸ Harden â†’ ğŸš€ Deploy"
    runs-on: ubuntu-latest
    needs: [security, quality]
    if: ${{ !cancelled() }}
    timeout-minutes: 20
    environment:
      name: production
      url: ${{ env.SITE_URL }}

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: npm

      - run: npm ci

      # â”€â”€â”€ BUILD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ”¨ Build Next.js static export
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  ğŸ”¨ BUILDING PRODUCTION SITE         â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

          START=$(date +%s)
          npm run build
          DUR=$(( $(date +%s) - START ))

          PAGES=$(find out -name '*.html' 2>/dev/null | wc -l)
          SIZE=$(du -sh out 2>/dev/null | cut -f1)
          echo ""
          echo "  â±ï¸  ${DUR}s  |  ğŸ“‘ $PAGES pages  |  ğŸ’¾ $SIZE"
          echo "  âœ… Build successful"
        env:
          CI: false
          NEXT_TELEMETRY_DISABLED: 1
          ESLINT_NO_DEV_ERRORS: true

      # â”€â”€â”€ HARDEN: .htaccess â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ›¡ï¸ Generate hardened .htaccess
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  ğŸ›¡ï¸ .htaccess HARDENING              â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

          cat > out/.htaccess << 'EOF'
# Helix Wiki â€” Security & Performance Config (auto-generated by CI/CD v4.0)

# â”€â”€ FORCE HTTPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# â”€â”€ WWW â†’ non-WWW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# â”€â”€ SECURITY HEADERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
<IfModule mod_headers.c>
  Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-XSS-Protection "1; mode=block"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set Permissions-Policy "camera=(), microphone=(), geolocation=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=(), interest-cohort=()"
  Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data: https:; connect-src 'self' https:; frame-ancestors 'self'; base-uri 'self'; form-action 'self'"
  Header always set Cross-Origin-Opener-Policy "same-origin"
  Header always set Cross-Origin-Resource-Policy "same-origin"
  Header always unset X-Powered-By
  Header always unset Server
</IfModule>

# â”€â”€ GZIP COMPRESSION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/css text/javascript
  AddOutputFilterByType DEFLATE application/javascript application/json application/xml
  AddOutputFilterByType DEFLATE image/svg+xml font/woff font/woff2
</IfModule>

# â”€â”€ BROWSER CACHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/png                 "access plus 1 year"
  ExpiresByType image/jpeg                "access plus 1 year"
  ExpiresByType image/gif                 "access plus 1 year"
  ExpiresByType image/svg+xml             "access plus 1 year"
  ExpiresByType image/webp                "access plus 1 year"
  ExpiresByType image/x-icon              "access plus 1 year"
  ExpiresByType font/woff2                "access plus 1 year"
  ExpiresByType font/woff                 "access plus 1 year"
  ExpiresByType text/css                  "access plus 1 month"
  ExpiresByType application/javascript    "access plus 1 month"
  ExpiresByType text/javascript           "access plus 1 month"
  ExpiresByType text/html                 "access plus 10 minutes"
  ExpiresByType application/json          "access plus 1 hour"
</IfModule>

# â”€â”€ BLOCK SENSITIVE FILES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
<FilesMatch "\.(env|git|gitignore|DS_Store|htpasswd|log|sql|bak|swp|yml|yaml|toml|lock|map)$">
  <IfModule mod_authz_core.c>
    Require all denied
  </IfModule>
</FilesMatch>

# Block hidden files (except .well-known)
<IfModule mod_rewrite.c>
  RewriteRule (^|/)\.(?!well-known/) - [F]
</IfModule>

# Block CI metadata
<FilesMatch "^_(sbom|build-manifest|checksums)\.">
  <IfModule mod_authz_core.c>
    Require all denied
  </IfModule>
</FilesMatch>

# â”€â”€ BLOCK MALICIOUS BOTS & SCANNERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
<IfModule mod_rewrite.c>
  RewriteCond %{HTTP_USER_AGENT} (AhrefsBot|MJ12bot|DotBot|SemrushBot|BLEXBot|PetalBot) [NC,OR]
  RewriteCond %{HTTP_USER_AGENT} (nikto|sqlmap|nmap|masscan|ZmEu|w3af|Havij) [NC]
  RewriteRule .* - [F,L]
</IfModule>

# â”€â”€ ERROR PAGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ErrorDocument 404 /404.html
ErrorDocument 403 /404.html
ErrorDocument 500 /404.html

# â”€â”€ MISC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Options -Indexes -MultiViews
AddDefaultCharset UTF-8
<IfModule mod_headers.c>
  Header unset ETag
</IfModule>
FileETag None
EOF

          echo "  âœ… .htaccess written ($(wc -l < out/.htaccess) lines)"
          echo "     â”œâ”€â”€ HTTPS force + wwwâ†’non-www"
          echo "     â”œâ”€â”€ HSTS 2yr + preload"
          echo "     â”œâ”€â”€ CSP + 9 security headers"
          echo "     â”œâ”€â”€ COOP + CORP"
          echo "     â”œâ”€â”€ Gzip compression"
          echo "     â”œâ”€â”€ 3-tier caching (1yr/1mo/10min)"
          echo "     â”œâ”€â”€ Sensitive file blocking"
          echo "     â”œâ”€â”€ Bot & scanner blocking"
          echo "     â””â”€â”€ ETag disabled"

      # â”€â”€â”€ HARDEN: Source maps removal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ—‘ï¸ Strip source maps
        run: |
          MAPS=$(find out -name '*.map' 2>/dev/null | wc -l)
          [ "$MAPS" -gt 0 ] && { find out -name '*.map' -delete; echo "  ğŸ—‘ï¸ Removed $MAPS source map(s)"; } || echo "  âœ… No source maps"

      # â”€â”€â”€ HARDEN: SBOM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“‹ Generate SBOM
        run: |
          cat > out/_sbom.json << EOF
          {
            "bomFormat": "HelixCI",
            "specVersion": "4.0",
            "metadata": {
              "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
              "component": "helix-wiki",
              "version": "$(jq -r '.version' package.json)",
              "pipeline": {
                "run": "${{ github.run_id }}",
                "sha": "${{ github.sha }}",
                "actor": "${{ github.actor }}"
              }
            },
            "dependencies": $(npm ls --json --depth=0 2>/dev/null | jq '.dependencies | keys' 2>/dev/null || echo '[]')
          }
          EOF
          sed -i 's/^          //' out/_sbom.json
          echo "  âœ… SBOM generated"

      # â”€â”€â”€ HARDEN: Build manifest â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“Š Build manifest
        run: |
          cat > out/_build-manifest.json << EOF
          {
            "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "sha": "${{ github.sha }}",
            "ref": "${{ github.ref_name }}",
            "run": ${{ github.run_number }},
            "actor": "${{ github.actor }}",
            "pages": $(find out -name '*.html' | wc -l),
            "files": $(find out -type f | wc -l),
            "size": "$(du -sh out | cut -f1)"
          }
          EOF
          sed -i 's/^          //' out/_build-manifest.json
          echo "  âœ… Manifest generated"

      # â”€â”€â”€ HARDEN: Integrity checksums â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ”’ SHA-256 integrity checksums
        run: |
          cd out
          find . -type f ! -name '_sbom.json' ! -name '_build-manifest.json' ! -name '_checksums.sha256' \
            -exec sha256sum {} + | sort > _checksums.sha256
          cd ..
          echo "  âœ… $(wc -l < out/_checksums.sha256) file checksums generated"
          echo "  ğŸ”‘ $(sha256sum out/_checksums.sha256 | cut -c1-16)â€¦"

      # â”€â”€â”€ DEPLOY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸš€ Deploy via FTPS to Hostinger
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          server-dir: ${{ secrets.FTP_REMOTE_PATH }}/
          local-dir: ./out/
          protocol: ftps
          log-level: minimal
          dangerous-clean-slate: false

      - name: ğŸ‰ Deploy confirmed
        run: |
          echo ""
          echo "  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "  â•‘  ğŸ‰ DEPLOYED TO PRODUCTION!          â•‘"
          echo "  â•‘                                      â•‘"
          echo "  â•‘  ğŸŒ ${{ env.SITE_URL }}               â•‘"
          echo "  â•‘  ğŸ“¦ $(echo '${{ github.sha }}' | cut -c1-7)"
          echo "  â•‘  ğŸ‘¤ ${{ github.actor }}"
          echo "  â•‘  ğŸ• $(date -u +'%H:%M:%S UTC')"
          echo "  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      # â”€â”€â”€ UPLOAD ARTIFACT (backup) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“¤ Archive build artifact
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: helix-wiki-${{ github.run_number }}
          path: out/
          retention-days: 14
          compression-level: 9

  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  #  âœ… POST-DEPLOY VERIFICATION
  #  Health checks â€¢ Security headers audit â€¢ SEO audit â€¢ Performance
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  verify:
    name: "âœ… Post-Deploy Verify"
    runs-on: ubuntu-latest
    needs: build-and-deploy
    if: success()
    timeout-minutes: 8
    continue-on-error: true

    steps:
      - name: â³ Propagation wait
        run: sleep 30

      # â”€â”€ HEALTH CHECKS (18 endpoints) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸŒ Health checks (18 endpoints)
        id: health
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  ğŸŒ HEALTH CHECKS                    â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""

          S="${{ env.SITE_URL }}"
          OK=0; KO=0; TO=0

          chk() {
            CODE=$(curl -s -o /dev/null -w "%{http_code}" --max-time 12 -L "$1" 2>/dev/null || echo 000)
            if [ "$CODE" = "${2:-200}" ]; then
              printf "  âœ…  %-28s %s\n" "$3" "$CODE"
              OK=$((OK+1))
            elif [ "$CODE" = "000" ]; then
              printf "  â±ï¸  %-28s TIMEOUT\n" "$3"
              TO=$((TO+1))
            else
              printf "  âŒ  %-28s %s\n" "$3" "$CODE"
              KO=$((KO+1))
            fi
          }

          echo "  â”€â”€ Pages â”€â”€"
          chk "$S/"                        200 "Homepage"
          chk "$S/docs/"                   200 "Docs Hub"
          chk "$S/docs/architecture/"      200 "Architecture"
          chk "$S/docs/core/"              200 "Core"
          chk "$S/docs/filesystem/"        200 "Filesystem"
          chk "$S/docs/hal/"               200 "HAL"
          chk "$S/docs/lumina/"            200 "Lumina"
          chk "$S/docs/modules/"           200 "Modules"
          chk "$S/docs/nexus/"             200 "NEXUS"
          chk "$S/docs/subsystems/"        200 "Subsystems"
          chk "$S/donate/"                 200 "Donate"
          chk "$S/download/"               200 "Download"

          echo ""
          echo "  â”€â”€ Assets â”€â”€"
          chk "$S/sitemap.xml"             200 "Sitemap"
          chk "$S/robots.txt"              200 "Robots.txt"
          chk "$S/favicon.ico"             200 "Favicon"
          chk "$S/og-image.png"            200 "OG Image"
          chk "$S/icon.svg"                200 "SVG Icon"

          echo ""
          echo "  â”€â”€ Error â”€â”€"
          chk "$S/nonexistent-page-test/"  200 "404 handling"

          TOTAL=$((OK+KO+TO))
          echo ""
          echo "  âœ… $OK  âŒ $KO  â±ï¸ $TO  (total: $TOTAL)"
          echo "health_pass=$OK" >> $GITHUB_OUTPUT
          echo "health_total=$TOTAL" >> $GITHUB_OUTPUT

      # â”€â”€ SECURITY HEADERS AUDIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ”’ Security headers audit
        id: secheaders
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  ğŸ”’ SECURITY HEADERS AUDIT           â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""

          H=$(curl -sI --max-time 12 -L "${{ env.SITE_URL }}" 2>/dev/null || echo "")
          [ -z "$H" ] && { echo "  âš ï¸ Unreachable"; exit 0; }

          S=0; T=0
          hdr() {
            T=$((T+1))
            if echo "$H" | grep -qi "$1"; then
              printf "  âœ…  %-32s\n" "$2"
              S=$((S+1))
            else
              printf "  âŒ  %-32s\n" "$2"
            fi
          }

          hdr "strict-transport-security"    "HSTS"
          hdr "x-content-type-options"       "X-Content-Type-Options"
          hdr "x-frame-options"              "X-Frame-Options"
          hdr "x-xss-protection"             "X-XSS-Protection"
          hdr "referrer-policy"              "Referrer-Policy"
          hdr "permissions-policy"           "Permissions-Policy"
          hdr "content-security-policy"      "CSP"
          hdr "cross-origin-opener-policy"   "COOP"
          hdr "cross-origin-resource-policy" "CORP"

          PCT=$((S*100/T))
          echo ""
          echo "  ğŸ“Š Score: $S/$T ($PCT%)"
          if   [ $PCT -ge 90 ]; then echo "  ğŸ† Grade: A+"
          elif [ $PCT -ge 75 ]; then echo "  ğŸ† Grade: A"
          elif [ $PCT -ge 60 ]; then echo "  ğŸ“— Grade: B"
          else echo "  ğŸ“™ Grade: C"; fi

          echo "sec_score=$S/$T" >> $GITHUB_OUTPUT

      # â”€â”€ SEO AUDIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ” SEO audit (17 tags)
        id: seo
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  ğŸ” SEO AUDIT                        â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""

          P=$(curl -s --max-time 12 -L "${{ env.SITE_URL }}" 2>/dev/null || echo "")
          [ -z "$P" ] && { echo "  âš ï¸ Unreachable"; exit 0; }

          S=0; T=0
          tag() {
            T=$((T+1))
            echo "$P" | grep -qi "$1" && { echo "  âœ… $2"; S=$((S+1)); } || echo "  âŒ $2"
          }

          echo "  â”€â”€ Essential â”€â”€"
          tag '<title'               "Title"
          tag 'meta.*description'    "Meta description"
          tag 'meta.*viewport'       "Viewport"
          tag 'link.*canonical'      "Canonical"
          tag 'html.*lang='          "Lang attribute"

          echo "  â”€â”€ Open Graph â”€â”€"
          tag 'og:title'             "OG: title"
          tag 'og:description'       "OG: description"
          tag 'og:image'             "OG: image"
          tag 'og:url'               "OG: url"
          tag 'og:type'              "OG: type"
          tag 'og:site_name'         "OG: site_name"

          echo "  â”€â”€ Twitter â”€â”€"
          tag 'twitter:card'         "Twitter card"
          tag 'twitter:title'        "Twitter title"
          tag 'twitter:description'  "Twitter description"

          echo "  â”€â”€ Extra â”€â”€"
          tag 'link.*icon'           "Favicon"
          tag 'theme-color'          "Theme color"
          tag 'apple.*icon'          "Apple icon"

          PCT=$((S*100/T))
          echo ""
          echo "  ğŸ“Š SEO: $S/$T ($PCT%)"
          echo "seo_score=$S/$T" >> $GITHUB_OUTPUT

      # â”€â”€ PERFORMANCE BASELINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: âš¡ Performance baseline
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  âš¡ PERFORMANCE BASELINE              â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""

          S="${{ env.SITE_URL }}"
          printf "  %-20s %-8s %-8s %-8s\n" "PAGE" "TTFB" "TOTAL" "SIZE"
          echo "  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

          perf() {
            R=$(curl -so /dev/null -w "t:%{time_starttransfer}|T:%{time_total}|s:%{size_download}" --max-time 15 -L "$1" 2>/dev/null || echo "")
            [ -z "$R" ] && { printf "  %-20s âš ï¸\n" "$2"; return; }
            TTFB=$(echo "$R" | grep -oP 't:\K[0-9.]+')
            TOT=$(echo "$R"  | grep -oP 'T:\K[0-9.]+')
            SZ=$(echo "$R"   | grep -oP 's:\K[0-9]+')
            KB=$((SZ/1024))
            IC="ğŸŸ¢"; (( $(echo "$TTFB > 0.8" | bc -l 2>/dev/null || echo 0) )) && IC="ğŸŸ¡"
            (( $(echo "$TTFB > 1.8" | bc -l 2>/dev/null || echo 0) )) && IC="ğŸ”´"
            printf "  $IC %-18s %-8s %-8s %-8s\n" "$2" "${TTFB}s" "${TOT}s" "${KB}KB"
          }

          perf "$S/"              "Homepage"
          perf "$S/docs/"         "Docs"
          perf "$S/docs/core/"    "Core"
          perf "$S/donate/"       "Donate"
          perf "$S/download/"     "Download"
          echo ""
          echo "  ğŸŸ¢ <0.8s  ğŸŸ¡ <1.8s  ğŸ”´ >1.8s"

  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  #  ğŸ“Š PIPELINE REPORT
  #  GitHub Actions Summary
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  report:
    name: "ğŸ“Š Report"
    runs-on: ubuntu-latest
    needs: [security, quality, build-and-deploy, verify]
    if: always()
    timeout-minutes: 3

    steps:
      - name: ğŸ“Š Pipeline summary
        run: |
          s() { case "$1" in success) echo "âœ…";; skipped) echo "â­ï¸";; failure) echo "âŒ";; *) echo "â“";; esac; }

          SEC=$(s "${{ needs.security.result }}")
          QUA=$(s "${{ needs.quality.result }}")
          BLD=$(s "${{ needs.build-and-deploy.result }}")
          VER=$(s "${{ needs.verify.result }}")

          [ "${{ needs.build-and-deploy.result }}" = "success" ] && R="ğŸ‰ DEPLOYED" || R="ğŸ’¥ FAILED"

          cat >> $GITHUB_STEP_SUMMARY << EOF

          # $R â€” Helix Wiki

          | Stage | Result |
          |-------|--------|
          | ğŸ›¡ï¸ Security Gate | $SEC |
          | âœ¨ Quality Gate | $QUA |
          | ğŸ”¨ Build + ğŸ›¡ï¸ Harden + ğŸš€ Deploy | $BLD |
          | âœ… Post-Deploy Verification | $VER |

          | | |
          |---|---|
          | ğŸŒ **Site** | [helix-wiki.com](${{ env.SITE_URL }}) |
          | ğŸ“¦ **Commit** | \`$(echo '${{ github.sha }}' | cut -c1-7)\` |
          | ğŸŒ¿ **Branch** | \`${{ github.ref_name }}\` |
          | ğŸ‘¤ **Actor** | @${{ github.actor }} |
          | ğŸ”¢ **Run** | [#${{ github.run_number }}](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}) |

          <details><summary>ğŸ›¡ï¸ Security features active</summary>

          - ğŸ” Secret scanning (15 patterns)
          - ğŸ” Dependency vulnerability audit
          - ğŸ“œ License compliance
          - ğŸ›¡ï¸ .htaccess (HSTS, CSP, COOP, CORP, 9 headers)
          - ğŸ—‘ï¸ Source map removal
          - ğŸ“‹ SBOM
          - ğŸ”’ SHA-256 checksums
          - ğŸ¤– Bot & scanner blocking
          - ğŸ“ Sensitive file blocking
          - ğŸ”€ HTTPS force redirect

          </details>

          ---
          <sub>Pipeline v4.0 â€” $(date -u +'%Y-%m-%d %H:%M UTC')</sub>
          EOF

          echo "  ğŸ“Š Report written to Actions Summary"
