# =============================================================================
# Helix Wiki â€” Secure FTP Deployment Pipeline (Hostinger)
# =============================================================================
#
# ğŸ—ï¸  Build (static export) â†’ Deploy via FTPS to Hostinger shared hosting
#
# Pipeline:
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚ ğŸ›¡ï¸ Quality   â”‚â”€â”€â”€â–¶â”‚ ğŸ—ï¸ Build   â”‚â”€â”€â”€â–¶â”‚ ğŸš€ Deploy  â”‚â”€â”€â”€â–¶â”‚ âœ… Verify â”‚â”€â”€â”€â–¶â”‚ ğŸ“¢ Notifyâ”‚
#   â”‚    Gate       â”‚    â”‚  (export)  â”‚    â”‚  (FTP/S)   â”‚    â”‚ (health) â”‚    â”‚(discord) â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# Security:
#   - Hardened runner (step-security)
#   - Minimal permissions (least privilege)
#   - Build integrity hash (SHA-256)
#   - FTPS (TLS encrypted) â€” never plain FTP
#   - Secret scanning (TruffleHog)
#   - Concurrency control
#   - Post-deploy health checks + SEO verification
#
# Required GitHub Secrets:
#   FTP_HOST         â€” Hostinger FTP hostname (e.g. ftp.helix-wiki.com)
#   FTP_USERNAME     â€” FTP username
#   FTP_PASSWORD     â€” FTP password
#   FTP_REMOTE_PATH  â€” Remote path (e.g. /public_html or /domains/helix-wiki.com/public_html)
#   DISCORD_WEBHOOK_URL â€” (optional) Discord webhook for notifications
#
# =============================================================================

name: ğŸš€ Deploy to Hostinger

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      clean_deploy:
        description: "Clean deploy (delete remote files first)"
        required: false
        type: boolean
        default: false
      dry_run:
        description: "Dry run (build only, skip FTP upload)"
        required: false
        type: boolean
        default: false

# =============================================================================
# SECURITY: Minimal permissions
# =============================================================================
permissions:
  contents: read
  actions: read
  deployments: write

# =============================================================================
# Concurrency: Only one deploy at a time
# =============================================================================
concurrency:
  group: production-deploy
  cancel-in-progress: true

env:
  NODE_VERSION: "22"
  NEXT_TELEMETRY_DISABLED: "1"
  SITE_URL: "https://helix-wiki.com"

jobs:
  # ===========================================================================
  # ğŸ›¡ï¸ STAGE 1 â€” Security & Quality Gate
  # ===========================================================================
  quality-gate:
    name: ğŸ›¡ï¸ Quality Gate
    runs-on: ubuntu-latest
    permissions:
      contents: read
      security-events: write
    outputs:
      should-deploy: ${{ steps.changes.outputs.should-deploy }}
    steps:
      - name: ğŸ” Harden Runner
        uses: step-security/harden-runner@v2
        with:
          egress-policy: audit
          disable-sudo: true

      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 2
          persist-credentials: false

      - name: ğŸ” Detect relevant changes
        id: changes
        run: |
          CHANGED=$(git diff --name-only HEAD~1 HEAD 2>/dev/null || echo "FIRST_PUSH")
          if echo "$CHANGED" | grep -qE '\.(tsx?|jsx?|css|json|mjs|svg|png|ico)$|next\.config|package'; then
            echo "should-deploy=true" >> "$GITHUB_OUTPUT"
            echo "âœ… Deployment-relevant files changed"
          elif [ "$CHANGED" = "FIRST_PUSH" ]; then
            echo "should-deploy=true" >> "$GITHUB_OUTPUT"
            echo "âœ… First push â€” deploying"
          else
            echo "should-deploy=false" >> "$GITHUB_OUTPUT"
            echo "â­ï¸  No deployment-relevant changes â€” skipping"
          fi

      - name: ğŸ”’ Scan for leaked secrets
        uses: trufflesecurity/trufflehog@main
        with:
          path: ./
          extra_args: --only-verified

      - name: ğŸ“¦ Setup Node.js
        if: steps.changes.outputs.should-deploy == 'true'
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: ğŸ“‹ Install dependencies
        if: steps.changes.outputs.should-deploy == 'true'
        run: npm ci --ignore-scripts

      - name: ğŸ” Lint
        if: steps.changes.outputs.should-deploy == 'true'
        run: npx eslint . --max-warnings 0
        continue-on-error: true

      - name: ğŸ” TypeScript check
        if: steps.changes.outputs.should-deploy == 'true'
        run: npx tsc --noEmit

  # ===========================================================================
  # ğŸ—ï¸ STAGE 2 â€” Build Static Export
  # ===========================================================================
  build:
    name: ğŸ—ï¸ Build
    runs-on: ubuntu-latest
    needs: quality-gate
    if: needs.quality-gate.outputs.should-deploy == 'true'
    permissions:
      contents: read
    outputs:
      build-hash: ${{ steps.hash.outputs.sha256 }}
      build-size: ${{ steps.stats.outputs.size }}
      page-count: ${{ steps.stats.outputs.pages }}
      file-count: ${{ steps.stats.outputs.files }}
    steps:
      - name: ğŸ” Harden Runner
        uses: step-security/harden-runner@v2
        with:
          egress-policy: audit
          disable-sudo: true

      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4
        with:
          persist-credentials: false

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: npm

      - name: ğŸ“‹ Install dependencies
        run: npm ci

      - name: ğŸ”¨ Build static export
        run: npx next build
        env:
          NODE_ENV: production

      - name: ğŸ“Š Build statistics
        id: stats
        run: |
          # next export outputs to "out/" with output: "export"
          SIZE=$(du -sh out/ | cut -f1)
          PAGES=$(find out -name 'index.html' | wc -l)
          FILES=$(find out -type f | wc -l)
          echo "size=$SIZE" >> "$GITHUB_OUTPUT"
          echo "pages=$PAGES" >> "$GITHUB_OUTPUT"
          echo "files=$FILES" >> "$GITHUB_OUTPUT"

          echo ""
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "â”‚  ğŸ“Š Build Statistics                         â”‚"
          echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
          printf "â”‚  %-12s %-30s  â”‚\n" "Size:" "$SIZE"
          printf "â”‚  %-12s %-30s  â”‚\n" "Pages:" "$PAGES"
          printf "â”‚  %-12s %-30s  â”‚\n" "Files:" "$FILES"
          printf "â”‚  %-12s %-30s  â”‚\n" "Node.js:" "$(node -v)"
          printf "â”‚  %-12s %-30s  â”‚\n" "Next.js:" "$(npx next --version)"
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"

          # List all generated pages
          echo ""
          echo "ğŸ“„ Generated pages:"
          find out -name 'index.html' | sort | sed 's|out/||; s|/index.html||; s|^index.html|/|' | while read -r p; do
            echo "   âœ… /${p}"
          done

      - name: ğŸ” Generate build integrity hash
        id: hash
        run: |
          HASH=$(find out -type f -exec sha256sum {} \; | sort | sha256sum | cut -d' ' -f1)
          echo "sha256=$HASH" >> "$GITHUB_OUTPUT"
          echo "ğŸ” Build integrity SHA-256: $HASH"

      - name: ğŸ“¤ Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: static-site-${{ github.sha }}
          path: out/
          retention-days: 7

  # ===========================================================================
  # ğŸš€ STAGE 3 â€” Deploy via FTPS to Hostinger
  # ===========================================================================
  deploy:
    name: ğŸš€ Deploy (FTP)
    runs-on: ubuntu-latest
    needs: [quality-gate, build]
    if: |
      needs.quality-gate.outputs.should-deploy == 'true' &&
      (github.event.inputs.dry_run != 'true')
    environment:
      name: production
      url: ${{ env.SITE_URL }}
    permissions:
      contents: read
      deployments: write
    steps:
      - name: ğŸ” Harden Runner
        uses: step-security/harden-runner@v2
        with:
          egress-policy: audit

      - name: ğŸ“¥ Download build artifact
        uses: actions/download-artifact@v4
        with:
          name: static-site-${{ github.sha }}
          path: out/

      - name: ğŸ” Verify build integrity
        run: |
          HASH=$(find out -type f -exec sha256sum {} \; | sort | sha256sum | cut -d' ' -f1)
          EXPECTED="${{ needs.build.outputs.build-hash }}"
          if [ "$HASH" != "$EXPECTED" ]; then
            echo "âŒ INTEGRITY CHECK FAILED â€” artifact was tampered with!"
            echo "   Expected: $EXPECTED"
            echo "   Got:      $HASH"
            exit 1
          fi
          echo "âœ… Build integrity verified: $HASH"

      - name: ğŸ“‹ Pre-deploy file inventory
        run: |
          echo "ğŸ“¦ Files to deploy:"
          echo "   Total: $(find out -type f | wc -l) files"
          echo "   HTML:  $(find out -name '*.html' | wc -l)"
          echo "   JS:    $(find out -name '*.js' | wc -l)"
          echo "   CSS:   $(find out -name '*.css' | wc -l)"
          echo "   Media: $(find out \( -name '*.png' -o -name '*.svg' -o -name '*.ico' -o -name '*.iso' \) | wc -l)"

      - name: ğŸš€ Deploy to Hostinger via FTPS
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: out/
          server-dir: ${{ secrets.FTP_REMOTE_PATH }}/
          protocol: ftps
          port: 21
          timeout: 600000
          log-level: minimal
          dangerous-clean-slate: ${{ github.event.inputs.clean_deploy == 'true' }}
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/.env*
            **/README.md

      - name: ğŸ“ Deploy log
        run: |
          echo ""
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "â”‚  ğŸš€ Deployment Complete                      â”‚"
          echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
          echo "â”‚  Method:    FTPS (TLS encrypted)             â”‚"
          echo "â”‚  Server:    Hostinger                        â”‚"
          echo "â”‚  Files:     ${{ needs.build.outputs.file-count }} files deployed"
          echo "â”‚  Pages:     ${{ needs.build.outputs.page-count }} pages"
          echo "â”‚  Size:      ${{ needs.build.outputs.build-size }}"
          echo "â”‚  Commit:    ${GITHUB_SHA::8}                 â”‚"
          echo "â”‚  Integrity: âœ… SHA-256 verified               â”‚"
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"

  # ===========================================================================
  # âœ… STAGE 4 â€” Post-Deploy Health Checks
  # ===========================================================================
  verify:
    name: âœ… Verify
    runs-on: ubuntu-latest
    needs: deploy
    permissions:
      contents: read
    steps:
      - name: ğŸ” Harden Runner
        uses: step-security/harden-runner@v2
        with:
          egress-policy: audit
          disable-sudo: true

      - name: â³ Wait for CDN propagation
        run: |
          echo "â³ Waiting 30s for CDN cache invalidation..."
          sleep 30

      - name: ğŸŒ Health checks
        run: |
          echo "ğŸŒ Running health checks against ${{ env.SITE_URL }}..."
          echo ""

          PASSED=0
          FAILED=0

          check() {
            local name="$1" url="$2" expect="$3"
            STATUS=$(curl -sL -o /dev/null -w "%{http_code}" --connect-timeout 15 --max-time 30 "$url")
            if [ "$STATUS" = "$expect" ]; then
              echo "  âœ… $name â€” HTTP $STATUS"
              PASSED=$((PASSED + 1))
            else
              echo "  âŒ $name â€” HTTP $STATUS (expected $expect)"
              FAILED=$((FAILED + 1))
            fi
          }

          check "Homepage"       "${{ env.SITE_URL }}/"                  "200"
          check "Docs"           "${{ env.SITE_URL }}/docs/"             "200"
          check "Architecture"   "${{ env.SITE_URL }}/docs/architecture/" "200"
          check "Core"           "${{ env.SITE_URL }}/docs/core/"        "200"
          check "HAL"            "${{ env.SITE_URL }}/docs/hal/"         "200"
          check "Subsystems"     "${{ env.SITE_URL }}/docs/subsystems/"  "200"
          check "Modules"        "${{ env.SITE_URL }}/docs/modules/"     "200"
          check "Filesystem"     "${{ env.SITE_URL }}/docs/filesystem/"  "200"
          check "NEXUS"          "${{ env.SITE_URL }}/docs/nexus/"       "200"
          check "Lumina"         "${{ env.SITE_URL }}/docs/lumina/"      "200"
          check "Donate"         "${{ env.SITE_URL }}/donate/"           "200"
          check "Download"       "${{ env.SITE_URL }}/download/"         "200"
          check "Robots.txt"     "${{ env.SITE_URL }}/robots.txt"        "200"
          check "Sitemap"        "${{ env.SITE_URL }}/sitemap.xml"       "200"
          check "Favicon SVG"    "${{ env.SITE_URL }}/icon.svg"          "200"
          check "OG Image"       "${{ env.SITE_URL }}/og-image.png"      "200"

          echo ""
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "â”‚  ğŸ¥ Health Check Results                     â”‚"
          echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
          printf "â”‚  âœ… Passed:  %-32s â”‚\n" "$PASSED"
          printf "â”‚  âŒ Failed:  %-32s â”‚\n" "$FAILED"
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"

          if [ "$FAILED" -gt 2 ]; then
            echo "::error::$FAILED health check(s) failed â€” deployment may be broken"
            exit 1
          elif [ "$FAILED" -gt 0 ]; then
            echo "::warning::$FAILED health check(s) failed"
          fi

      - name: ğŸ” SEO verification
        run: |
          echo "ğŸ” Verifying SEO tags on homepage..."
          HTML=$(curl -sL --max-time 30 "${{ env.SITE_URL }}/")

          PASS=0
          WARN=0

          seo() {
            local tag="$1" pattern="$2"
            if echo "$HTML" | grep -qi "$pattern"; then
              echo "  âœ… $tag"
              PASS=$((PASS + 1))
            else
              echo "  âš ï¸  Missing: $tag"
              WARN=$((WARN + 1))
            fi
          }

          seo "Title"            "<title>"
          seo "Meta description" 'name="description"'
          seo "OG title"         'property="og:title"'
          seo "OG description"   'property="og:description"'
          seo "OG image"         'property="og:image"'
          seo "OG url"           'property="og:url"'
          seo "Twitter card"     'name="twitter:card"'
          seo "Canonical"        'rel="canonical"'
          seo "Favicon"          'rel="icon"'
          seo "JSON-LD"          'application/ld+json'
          seo "Viewport"         'name="viewport"'

          echo ""
          echo "  SEO Score: $PASS/11 tags present"
          if [ "$WARN" -gt 0 ]; then
            echo "::warning::$WARN SEO tag(s) missing"
          fi

      - name: ğŸ“ Response time baseline
        run: |
          echo "ğŸ“ Response times:"
          echo ""
          for path in "/" "/docs/" "/donate/" "/download/"; do
            TIME=$(curl -sL -o /dev/null -w "%{time_total}" --connect-timeout 10 "${{ env.SITE_URL }}$path")
            MS=$(echo "$TIME * 1000" | bc | cut -d'.' -f1)
            if [ "$MS" -lt 500 ]; then
              printf "  âš¡ %-20s %sms\n" "$path" "$MS"
            elif [ "$MS" -lt 2000 ]; then
              printf "  ğŸŸ¡ %-20s %sms\n" "$path" "$MS"
            else
              printf "  ğŸ”´ %-20s %sms\n" "$path" "$MS"
            fi
          done

      - name: ğŸ”’ Security headers check
        run: |
          echo "ğŸ”’ Checking security headers..."
          HEADERS=$(curl -sI --max-time 15 "${{ env.SITE_URL }}/")

          sec() {
            local name="$1" header="$2"
            if echo "$HEADERS" | grep -qi "$header"; then
              echo "  âœ… $name"
            else
              echo "  âš ï¸  Missing: $name"
            fi
          }

          sec "HTTPS redirect"          "strict-transport"
          sec "X-Content-Type-Options"  "x-content-type-options"
          sec "X-Frame-Options"         "x-frame-options"
          sec "Content-Type"            "content-type"

  # ===========================================================================
  # ğŸ“¢ STAGE 5 â€” Notifications
  # ===========================================================================
  notify:
    name: ğŸ“¢ Notify
    runs-on: ubuntu-latest
    needs: [build, deploy, verify]
    if: always()
    permissions:
      contents: read
    steps:
      - name: ğŸ“¢ Discord notification
        if: vars.DISCORD_WEBHOOK_URL != '' || secrets.DISCORD_WEBHOOK_URL != ''
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          if [ -z "$DISCORD_WEBHOOK_URL" ]; then
            echo "â„¹ï¸  No Discord webhook configured â€” skipping"
            exit 0
          fi

          if [ "${{ needs.deploy.result }}" = "success" ]; then
            COLOR=3066993
            EMOJI="âœ…"
            TITLE="Helix Wiki Deployed"
            DESC="Static site successfully deployed to Hostinger via FTPS."
          elif [ "${{ needs.deploy.result }}" = "skipped" ]; then
            COLOR=16776960
            EMOJI="â­ï¸"
            TITLE="Deployment Skipped"
            DESC="No relevant changes detected â€” deploy was skipped."
          else
            COLOR=15158332
            EMOJI="âŒ"
            TITLE="Deployment Failed"
            DESC="The deployment pipeline encountered an error. Check the workflow logs."
          fi

          curl -sf -H "Content-Type: application/json" \
            -d "{
              \"embeds\": [{
                \"title\": \"$EMOJI $TITLE\",
                \"description\": \"$DESC\",
                \"color\": $COLOR,
                \"fields\": [
                  { \"name\": \"ğŸ”— Commit\", \"value\": \"\`${GITHUB_SHA::8}\`\", \"inline\": true },
                  { \"name\": \"ğŸ‘¤ Author\", \"value\": \"${{ github.actor }}\", \"inline\": true },
                  { \"name\": \"ğŸ“Š Build\", \"value\": \"${{ needs.build.outputs.page-count }} pages Â· ${{ needs.build.outputs.file-count }} files Â· ${{ needs.build.outputs.build-size }}\", \"inline\": false },
                  { \"name\": \"ğŸŒ Site\", \"value\": \"[${{ env.SITE_URL }}](${{ env.SITE_URL }})\", \"inline\": false }
                ],
                \"footer\": { \"text\": \"Helix Wiki CI/CD â€” FTP Deploy\" },
                \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"
              }]
            }" \
            "$DISCORD_WEBHOOK_URL" || echo "âš ï¸  Discord notification failed (non-critical)"

      - name: ğŸ“ Deployment summary
        if: always()
        run: |
          STATUS="${{ needs.deploy.result }}"
          if [ "$STATUS" = "success" ]; then
            BADGE="âœ… Success"
          elif [ "$STATUS" = "skipped" ]; then
            BADGE="â­ï¸ Skipped"
          else
            BADGE="âŒ Failed"
          fi

          cat >> "$GITHUB_STEP_SUMMARY" << EOF
          ## ğŸš€ Deployment Summary

          | Detail | Value |
          |--------|-------|
          | **Status** | $BADGE |
          | **Method** | FTPS (TLS encrypted) |
          | **URL** | [${{ env.SITE_URL }}](${{ env.SITE_URL }}) |
          | **Commit** | \`${{ github.sha }}\` |
          | **Pages** | ${{ needs.build.outputs.page-count }} |
          | **Files** | ${{ needs.build.outputs.file-count }} |
          | **Size** | ${{ needs.build.outputs.build-size }} |
          | **Integrity** | \`${{ needs.build.outputs.build-hash }}\` |
          | **Actor** | @${{ github.actor }} |
          | **Trigger** | \`${{ github.event_name }}\` |

          ### ğŸ”’ Security Checklist
          - âœ… Harden Runner active on all stages
          - âœ… Secret scanning passed (TruffleHog)
          - âœ… Build integrity verified (SHA-256)
          - âœ… FTPS encrypted transfer
          - âœ… No credentials in logs
          - âœ… Health checks: ${{ needs.verify.result }}
          EOF
